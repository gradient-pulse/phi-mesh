<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Phi-Mesh Tag Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg:#0b0c10; --panel:#10131a; --fg:#e9eef8; --muted:#9aa6b8;
      --link:#9fc9ff; --linkDim:rgba(180,200,230,.14);
      --pulseWarm:#ff7a66; --pulseMed:#ffb066; --pulseCool:#86cbff; --pulseCooler:#74a9ff;
      --active:#ff6b6b;
    }
    html, body { height:100%; margin:0; background:var(--bg); color:var(--fg) }
    body { font:14px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial }

    .app {
      display:grid;
      grid-template-columns: 360px 1fr 340px;
      gap: 0;
      height:100%;
    }

    /* Left sidebar (pulse details) */
    aside.left {
      padding:14px;
      border-right:1px solid rgba(255,255,255,.06);
    }
    h1 { margin:0 0 6px 0; font-size:18px; letter-spacing:.2px }
    .subtle { color:var(--muted); font-size:12px; margin:0 0 10px 0 }
    #search {
      width:100%; background:#0f1218; border:1px solid rgba(255,255,255,.08);
      color:var(--fg); padding:9px 10px; border-radius:8px; outline:none;
    }
    #sidebar-content {
      margin-top:12px;
      font-size:13px;       /* a bit smaller */
      line-height:1.4;
      overflow:hidden;      /* hide scrollbars */
    }
    .ellipsis { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; display:block }

    /* Right sidebar (pulse list for selected tag) */
    aside.right {
      padding:14px;
      border-left:1px solid rgba(255,255,255,.06);
    }
    .right h2 { margin:0 0 8px 0; font-size:16px }
    .plist { margin:8px 0 0 0; padding:0; list-style:none; max-height:calc(100vh - 90px); overflow:auto }
    .plist li {
      display:flex; align-items:center; gap:8px;
      padding:5px 4px; border-radius:6px; cursor:pointer;
    }
    .plist li:hover { background:#121722 }
    .dot { width:8px; height:8px; border-radius:50% }
    .age-very-new { background:var(--pulseWarm) }
    .age-new      { background:#ff9b66 }
    .age-mid      { background:var(--pulseMed) }
    .age-old      { background:var(--pulseCool) }
    .age-very-old { background:var(--pulseCooler) }
    .pdate { color:var(--muted); font-size:12px; margin-left:auto; }

    /* Graph */
    svg { width:100%; height:100% }
    .link { stroke:#b9c7dd; stroke-opacity:.22 }
    .link.dim { stroke-opacity:.06 }
    .node text { font-size:12px; fill:#d3e0f2; pointer-events:none }
    .node ellipse { fill:#74b7ff; stroke:none }
    .node.dim text { opacity:.2 }
    .node.dim ellipse { opacity:.24 }
    .node.active ellipse { fill:var(--active) }
    #tooltip {
      position:fixed; left:0; top:0; display:none; z-index:20;
      background:#0f1522; color:var(--fg);
      border:1px solid rgba(255,255,255,.08); border-radius:10px;
      padding:10px 12px; max-width:300px; box-shadow:0 6px 18px rgba(0,0,0,.35);
      pointer-events:none;
    }

    /* Make links one line in left sidebar */
    .sidebar-links a { color:var(--link); text-decoration:none }
    .sidebar-links li { margin:4px 0; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="data.js"></script>  <!-- window.PHI_DATA -->
  <script src="map.js"></script>   <!-- renderer -->
</head>
<body>
  <div class="app">
    <aside class="left">
      <h1>Phi-Mesh Tag Map</h1>
      <div class="subtle">Hover a tag for its description • Click a tag to list pulses • Click a pulse to see details</div>
      <input id="search" type="search" placeholder="Type to filter…" />
      <div id="sidebar-content"></div>
    </aside>

    <svg id="graph" role="img" aria-label="Tag Map"></svg>

    <aside class="right">
      <h2 id="plist-title">Pulses</h2>
      <ul id="plist" class="plist"></ul>
    </aside>
  </div>
  <div id="tooltip"></div>
</body>
</html>
